> 字符流转，就此谱写逻辑华章

# 概述

在本学期的编译实验中，我实现了一个简单的编译器，支持将SysY语义编译为MIPS汇编，并进行一些效果还不错的优化。

编译器的实现参考了理论课中给出的五级架构，即：

1. 词法分析：将源程序解析为token序列，并在此过程中进行代码的错误检查，是否有明显的词法错误

2. 语法分析：在token流基础上构建抽象语法树，并在此过程中识别源程序中的不合理成分

3. 语义分析、中间代码生成：基于语法分析得到的抽象语法树，将语法树转换为中间代码形式，同时在这个过程中识别一部分语义问题、符号问题，实现程序的初始架构

   此外，中间代码采用了LLVM，基于其value-use框架搭建了程序内部的依赖关系

4. 代码优化：实现了一些典型的代码优化，如：mem2reg、寄存器分配，LVN、死代码删除、公共子表达式删除、乘除法优化等，实现了较好的效果

5. 生成目标代码：将LLVM-IR转换为MIPS代码，并进行寄存器分配，得到可在目标体系结构上运行的MIPS汇编代码

编译器的整体代码结构为：

```
├─backend
│  └─mips
│      └─assembly
│          ├─data
│          └─fake
├─error
├─frontend
│  ├─ast
│  │  ├─block
│  │  ├─decl
│  │  ├─exp
│  │  │  └─recursion
│  │  ├─func
│  │  ├─stmt
│  │  ├─token
│  │  └─value
│  ├─lexer
│  └─parser
├─META-INF
├─midend
│  ├─llvm
│  │  ├─constant
│  │  ├─instr
│  │  │  ├─io
│  │  │  └─phi
│  │  ├─type
│  │  ├─use
│  │  └─value
│  ├─symbol
│  └─visit
├─optimize
└─utils
```

编译器的架构遵循的较为规整的前后端分离架构，具备良好的可扩展性。

# 词法分析



# 语法分析



# 语义分析



# 中间代码生成



# 目标代码生成



# 代码优化